@using DataTransferObject.Model;
@model LoginViewModel;
@{
    ViewData["Title"] = "Login";
    Layout = "~/Views/Shared/_LayoutMain.cshtml";
}
<link href="~/css/login.css" rel="stylesheet" />
@* <style>
      .login-card {
            width: clamp(320px, 90vw, 450px);
            border: none;
            border-radius: clamp(12px, 3vw, 20px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1), 0 5px 15px rgba(0,0,0,0.07);
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: clamp(1.5rem, 4vw, 2.5rem) !important;
            margin-top: clamp(1rem, 5vh, 3rem) !important;
        } 

        .Loginpagetitle h1 {
            color: #2c3e50;
            font-weight: 700;
            margin-bottom: clamp(1.5rem, 4vw, 2.5rem);
            text-align: center;
            font-size: clamp(1.75rem, 5vw, 2.5rem);
            position: relative;
        }
 
      
        .Loginpagetitle h1:after {
               width: 100px;
    height: 1px;
    display: block;
    content: "";
    position: relative;
    margin-top: 25px;
    left: 50%;
    margin-left: -50px;
    background-color: #b80000;
        } 
        .Loginpagetitle h1:before {
    width: 28px;
    height: 5px;
    display: block;
    content: "";
    position: absolute;
    bottom: -2px;
    left: 50%;
    margin-left: -14px;
    background-color: #b80000;
}

        .form-label {
            font-weight: 600;
            color: #495057;
            margin-bottom: clamp(0.375rem, 1.5vw, 0.625rem);
            font-size: clamp(0.875rem, 2.5vw, 1rem);
        } 

         .form-control {
            border: 2px solid #e9ecef;
            border-radius: clamp(8px, 2vw, 12px);
            padding: clamp(0.625rem, 2.5vw, 0.875rem) clamp(0.75rem, 3vw, 1rem);
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            transition: all 0.3s ease;
            background-color: #fafbfc;
        } 

         .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
            background-color: white;
        }

        .form-control:disabled {
            background-color: #f8f9fa;
            opacity: 0.65;
        }

        .input-group .form-control {
            border-radius: clamp(8px, 2vw, 12px);
        } 

       .mb-3 {
            margin-bottom: clamp(1rem, 3vw, 1.5rem) !important;
        }

        .btn {
            border-radius: clamp(8px, 2vw, 12px);
            padding: clamp(0.625rem, 2.5vw, 0.875rem) clamp(1.25rem, 4vw, 2rem);
            font-weight: 600;
            font-size: clamp(0.875rem, 2.5vw, 1rem);
            transition: all 0.3s ease;
            min-height: clamp(2.5rem, 8vw, 3rem);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: clamp(0.5rem, 1.5vw, 0.75rem);
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }

        .btn-success:hover:not(:disabled) {
            background: linear-gradient(45deg, #218838, #1aa179);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }

        .btn:disabled {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            transform: none !important;
            box-shadow: none;
        }

        .alert {
            border-radius: clamp(8px, 2vw, 12px);
            padding: clamp(0.75rem, 2.5vw, 1rem);
            margin-bottom: clamp(1rem, 3vw, 1.5rem);
            font-size: clamp(0.875rem, 2.5vw, 0.9rem);
            border: none;
            backdrop-filter: blur(5px);
        }

        .alert-danger {
            background: rgba(220, 53, 69, 0.1);
            color: #721c24;
            border-left: clamp(3px, 0.8vw, 5px) solid #dc3545;
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.1);
            color: #856404;
            border-left: clamp(3px, 0.8vw, 5px) solid #ffc107;
        }

        .alert-info {
            background: rgba(13, 110, 253, 0.1);
            color: #055160;
            border-left: clamp(3px, 0.8vw, 5px) solid #0dcaf0;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: clamp(0.5rem, 2vw, 0.75rem);
        }

        .checkbox-container input[type="checkbox"] {
            width: clamp(16px, 4vw, 20px);
            height: clamp(16px, 4vw, 20px);
            accent-color: #667eea;
        }

        .checkbox-container label {
            margin-bottom: 0;
            cursor: pointer;
            user-select: none;
        }

       

     .countdown-container {
            background: rgba(220, 53, 69, 0.05);
            padding: clamp(0.75rem, 2.5vw, 1rem);
            border-radius: clamp(6px, 1.5vw, 10px);
            margin-top: clamp(1rem, 3vw, 1.5rem);
            text-align: center;
        }

        #countdown {
            font-size: clamp(1rem, 3vw, 1.25rem);
            color: #dc3545;
            font-weight: 700;
        }

        /* Animation for loading state */
        .btn.loading {
            position: relative;
            color: transparent;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: clamp(16px, 4vw, 20px);
            height: clamp(16px, 4vw, 20px);
            border: 2px solid transparent;
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @@keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Focus states for accessibility */
        .form-control:focus,
        .btn:focus,
        input[type="checkbox"]:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        /* Mobile-first responsive adjustments */
        @@media (max-width: 480px) {
            .login-card {
                width: 95vw;
                margin-top: clamp(0.5rem, 3vh, 2rem) !important;
                padding: clamp(1rem, 4vw, 1.5rem) !important;
            }
            
            .pagetitle h1 {
                font-size: clamp(1.5rem, 6vw, 2rem);
                margin-bottom: clamp(1rem, 4vw, 2rem);
            }
            
            .alert {
                font-size: clamp(0.8rem, 2.5vw, 0.85rem);
            }
        }

        /* Large screen optimizations */
        @@media (min-width: 1200px) {
            .login-card {
                margin-top: 8vh !important;
            }
        }

        /* High contrast mode */
        @@media (prefers-contrast: high) {
            .form-control {
                border-width: 3px;
            }
            
            .btn {
                border: 2px solid;
            }
        }

        /* Reduced motion */
        @@media (prefers-reduced-motion: reduce) {
            .btn,
            .form-control {
                transition: none;
            }
            
            .btn:hover {
                transform: none;
            }
        }

  

    
</style>
 *@
<div class="container-fluid mt-2">
    <div class="d-flex justify-content-center align-items-center  min-vh-50">
        <div class="card login-card shadow">
            <div class="Loginpagetitle">
                <h1>Login</h1>
            </div>

            @* Lockout Alert *@
            @if (Model?.IsLockedOut == true)
            {
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-lock me-2"></i>
                    <strong>Account Locked!</strong><br />
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            @* Validation Summary *@
            @if (!ViewData.ModelState.IsValid)
            {
                <div class="alert alert-warning alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    @foreach (var error in ViewData.ModelState.Values.SelectMany(v => v.Errors))
                    {
                        <div>@error.ErrorMessage</div>
                    }
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <form asp-action="Login" method="post" id="loginForm">
                <div class="mb-3">
                    <div class="form-group">
                        <label asp-for="UserName">Username:</label>
                        <input type="text" asp-for="UserName" class="form-control"
                               disabled="@(Model?.IsLockedOut == true)" />
                        <span asp-validation-for="UserName" class="text-danger"></span>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="form-group">
                        <label asp-for="Password">Password:</label>
                        <div class="input-group">
                            <input type="password" asp-for="Password" class="form-control"
                                   autocomplete="off" disabled="@(Model?.IsLockedOut == true)" />
                        </div>
                        <span asp-validation-for="Password" class="text-danger"></span>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="checkbox-container">
                        <input type="checkbox" asp-for="RememberMe" disabled="@(Model?.IsLockedOut == true)" />
                        <label asp-for="RememberMe">Remember Me</label>
                    </div>
                </div>

                @* Attempt Counter *@
                @if (Model?.FailedAttempts > 0 && Model?.IsLockedOut != true)
                {
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        Failed attempts: @Model.FailedAttempts/@Model.MaxAllowedAttempts
                        
                    </div>
                }

                <div class="d-flex justify-content-center align-items-center">
                    <button type="submit" class="btn btn-success"
                            disabled="@(Model?.IsLockedOut == true)" id="loginBtn">
                        @if (Model?.IsLockedOut == true)
                        {
                            <i class="fas fa-lock me-2"></i>

                            @: Account Locked
                        }
                        else
                        {

                            @: Login
                        }
                    </button>
                </div>

                @* Countdown Timer for Lockout *@
                @if (Model?.IsLockedOut == true && Model?.LockoutEnd.HasValue == true)
                {
                    <div class="text-center mt-3">
                        <small class="text-muted">
                            Time remaining: <span id="countdown" class="fw-bold text-danger"></span>
                        </small>
                    </div>
                }
            </form>
        </div>
    </div>
</div>




@section Scripts {
    <script src="~/DevJs/Login.js"></script>
    @{
        var isLockedOut = Model?.IsLockedOut ?? false;
        var lockoutEndStr = "null";
        var autoRefreshTimeoutStr = "null";

        if (isLockedOut && Model?.LockoutEnd.HasValue == true)
        {
            // ISO 8601 format for JS Date parsing
            lockoutEndStr = Model.LockoutEnd.Value.ToString("yyyy-MM-ddTHH:mm:ss.fffZ");

            // Calculate auto refresh timeout in milliseconds
            var timeoutMs = Math.Max(1000, (Model.LockoutEnd.Value - DateTime.UtcNow).TotalMilliseconds + 1000);
            autoRefreshTimeoutStr = timeoutMs.ToString("F0"); // no decimal
        }
    }

    <div id="loginConfig"
         data-is-locked-out="@isLockedOut.ToString().ToLower()"
         data-lockout-end="@lockoutEndStr"
         data-auto-refresh-timeout="@autoRefreshTimeoutStr">
    </div>
}